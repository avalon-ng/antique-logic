// Generated by BUCKLESCRIPT VERSION 4.0.0, PLEASE EDIT WITH CARE
'use strict';

var Block = require("bs-platform/lib/js/block.js");
var Belt_Array = require("bs-platform/lib/js/belt_Array.js");
var Caml_int32 = require("bs-platform/lib/js/caml_int32.js");
var Json_decode = require("@glennsl/bs-json/src/Json_decode.bs.js");
var Json_encode = require("@glennsl/bs-json/src/Json_encode.bs.js");

var roles = /* array */[
  /* XuYuan */0,
  /* FangZhen */1,
  /* MuHuJiaNai */2,
  /* HuangYanYan */3,
  /* LaoChaoFeng */5,
  /* YaoBuRan */6,
  /* ZhengGuoQu */7,
  /* JiYunFu */4
];

var game_001 = /* nested : record */[
  /* a */0,
  /* b */0
];

var game = /* record */[
  /* state : Init */0,
  game_001,
  /* name */"just started",
  /* activePlayer */0,
  /* playerCount */6,
  /* roles */roles
];

var InitState = /* module */[/* game */game];

function action(json) {
  var match = Json_decode.field("type", Json_decode.string, json);
  switch (match) {
    case "dramatic_action" : 
        return /* Dramatic */Block.__(2, [
                  Json_decode.field("a", Json_decode.$$int, json),
                  Json_decode.field("b", Json_decode.$$int, json)
                ]);
    case "init" : 
        return /* Init */Block.__(0, [Json_decode.field("playerCount", Json_decode.$$int, json)]);
    case "update_name" : 
        return /* UpdateName */Block.__(1, [Json_decode.field("name", Json_decode.string, json)]);
    default:
      return undefined;
  }
}

var Decode = /* module */[/* action */action];

function role(role$1) {
  switch (role$1) {
    case 0 : 
        return "xu_yuan";
    case 1 : 
        return "fang_zhen";
    case 2 : 
        return "mu_hu_jia_nai";
    case 3 : 
        return "huang_yan_yan";
    case 4 : 
        return "ji_yun_fu";
    case 5 : 
        return "lao_chao_feng";
    case 6 : 
        return "yao_bu_ran";
    case 7 : 
        return "zheng_guo_qu";
    
  }
}

function gameState(state) {
  var match = state[/* state */0];
  var tmp;
  switch (match) {
    case 0 : 
        tmp = "init";
        break;
    case 1 : 
        tmp = "turn_action";
        break;
    case 2 : 
        tmp = "vote_zodiac";
        break;
    case 3 : 
        tmp = "vote_player";
        break;
    case 4 : 
        tmp = "end";
        break;
    
  }
  return Json_encode.object_(/* :: */[
              /* tuple */[
                "state",
                tmp
              ],
              /* :: */[
                /* tuple */[
                  "name",
                  state[/* name */2]
                ],
                /* :: */[
                  /* tuple */[
                    "activePlayer",
                    state[/* activePlayer */3]
                  ],
                  /* :: */[
                    /* tuple */[
                      "roles",
                      Json_encode.array(role, state[/* roles */5])
                    ],
                    /* :: */[
                      /* tuple */[
                        "payload",
                        Json_encode.object_(/* :: */[
                              /* tuple */[
                                "a",
                                state[/* nested */1][/* a */0]
                              ],
                              /* :: */[
                                /* tuple */[
                                  "b",
                                  state[/* nested */1][/* b */1]
                                ],
                                /* [] */0
                              ]
                            ])
                      ],
                      /* [] */0
                    ]
                  ]
                ]
              ]
            ]);
}

var Encode = /* module */[
  /* role */role,
  /* gameState */gameState
];

function reduce$prime(state, action) {
  switch (action.tag | 0) {
    case 0 : 
        var playerCount = action[0];
        return /* record */[
                /* state : Init */0,
                /* nested : record */[
                  /* a */0,
                  /* b */0
                ],
                /* name */"just started",
                /* activePlayer */0,
                /* playerCount */playerCount,
                /* roles */Belt_Array.shuffle((function (param) {
                          return Belt_Array.slice(param, 0, playerCount);
                        })(roles))
              ];
    case 1 : 
        return /* record */[
                /* state : TurnAction */1,
                /* nested */state[/* nested */1],
                /* name */action[0],
                /* activePlayer */state[/* activePlayer */3],
                /* playerCount */state[/* playerCount */4],
                /* roles */state[/* roles */5]
              ];
    case 2 : 
        return /* record */[
                /* state : VotePlayer */3,
                /* nested : record */[
                  /* a */Caml_int32.imul(state[/* nested */1][/* a */0] + 1 | 0, action[0]),
                  /* b */Caml_int32.imul(Caml_int32.imul(state[/* nested */1][/* b */1], action[1]) + 2 | 0, -1)
                ],
                /* name */state[/* name */2],
                /* activePlayer */state[/* activePlayer */3],
                /* playerCount */state[/* playerCount */4],
                /* roles */state[/* roles */5]
              ];
    
  }
}

var toJs = gameState;

function reduce(state, jsAction) {
  if (state !== undefined) {
    var state$prime = state;
    var match = action(jsAction);
    if (match !== undefined) {
      return reduce$prime(state$prime, match);
    } else {
      return state$prime;
    }
  } else {
    return game;
  }
}

exports.roles = roles;
exports.InitState = InitState;
exports.Decode = Decode;
exports.Encode = Encode;
exports.reduce$prime = reduce$prime;
exports.toJs = toJs;
exports.reduce = reduce;
/* Json_encode Not a pure module */
